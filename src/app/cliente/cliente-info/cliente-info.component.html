
<div class="card box m-6 mt-8 mb-8">
  <div class="bannerCliente">
    <div class="col-2 ">
      <div class="flex justify-content-center align-items-center mt-6">
        <p-image src="https://img.freepik.com/fotos-gratis/mulher-jovem-feliz-cumprimentando-alguem-via-skype_259150-60475.jpg?size=626&ext=jpg&ga=GA1.1.1546980028.1702425600&semt=sph"
        width="180"
        alt="Foto de perfil do paciente"
        [preview]="true"
        ></p-image>
      </div>
      <div class="flex justify-content-center align-items-center">
        <!-- <p-button label="Editar" [text]="true" [rounded]="true" severity="danger" icon="pi pi-pencil"size="small"></p-button> -->
        <span class="text-red-500 font-bold text-sm cursor-pointer hover:text-red-600 m-1" (click)="abrirModalFoto()"> <i class="pi pi-pencil text-sm"></i>&nbsp;&nbsp;Alterar foto</span>
      </div>
    </div>

    <div class="col-10">
      <div class="grid">
        <div class="col-12">
          <div class="mt-6">
            <span class="text-5xl font-semibold p-component">{{paciente.nome}}&nbsp;&nbsp;&nbsp;</span>
             <p-tag
            [severity]="(paciente.ativo? 'success' : 'danger')"
            [value]="paciente?.ativo? ' Ativo ':' Inativo '"
            [rounded]="true">
              <i class="material-icons" *ngIf="paciente?.ativo">task_alt</i>
              <i class="material-icons" *ngIf="!paciente?.ativo">block</i>
            </p-tag>
            <span clas="ml-3">

            </span>
          </div>
        </div>
      </div>
      <div class="grid mt-5">

        <div class="col-1 flex justify-content-center ">
          <p class="text-xl font-semibold flex align-items-end p-component">
            <i class="pi pi-folder-open text-2xl"></i>
            &nbsp;&nbsp;{{paciente.numPasta}}
          </p>
        </div>
        <div class="col-2 flex justify-content-center align-content-center ">
          <p class="text-xl font-semibold flex align-items-center p-component">
            <i class="pi pi-calendar text-2xl"></i>
            &nbsp;&nbsp;{{ calcularIdade(paciente.dataNascimento) }}
          </p>
        </div>
        <div class="col-2 flex justify-content-center align-content-center ">
          <p class="text-xl font-semibold flex align-items-center p-component cursor-pointer hover:text-green-900" (click)="abrirwhatsapp()">
            <i class="pi pi-whatsapp text-2xl text-green-700"></i>
             &nbsp;&nbsp;{{paciente.telefone}}
           </p>
        </div>
        <div class="col-2 mt-3" *ngIf="paciente.responsavel?.telefone">
          <span class="text-xl font-semibold flex align-items-center p-component cursor-pointer hover:text-green-900 flex justify-content-center align-content-center " (click)="abrirwhatsapp()">
            <i class="pi pi-whatsapp text-2xl text-green-700"></i>
             &nbsp;&nbsp;{{paciente.responsavel?.telefone}}
          </span>
          <small class="flex justify-content-center ">Contato do responsável</small>
        </div>

        <div class="col-3 ">
          <!-- <p-speedDial [model]="items" direction="down" [transitionDelay]="80" showIcon="pi pi-bars" hideIcon="pi pi-times" buttonClassName="p-button-outlined"></p-speedDial> -->
        </div>
      </div>
    </div>
  </div>
  <div class="card flex justify-content-end m-3 mr-4">
    <p-menubar [model]="items" styleClass="menuBar"></p-menubar>
  </div>
  <div class="flex m-3 ">
    <div class="col-12">
      <p-tabView styleClass="tabview-custom" [(activeIndex)]="activeIndex">
        <p-tabPanel header="Informacoes">
          <ng-template pTemplate="header">
            <i class="pi pi-fw pi-user"></i>
            <span>&nbsp;Informações</span>
          </ng-template>
            <form  [formGroup]="formulario" (ngSubmit)="onUpdate()" class="pl-8 pr-8 ">


            <div class="row flex justify-content-center m-5">
              <div class="field col-5">
                <span class="p-float-label p-input-icon-left width">
                  <i class="pi pi-pencil azul"></i>
                  <input pInputText id="nome" [value]="paciente?.nome" *ngIf="disable" required class="width" [disabled]="disable" />
                  <input pInputText id="nome" *ngIf="disable == false" formControlName="nome" required class="width" />
                  <label for="nome" class="azul">Nome Completo</label>
                </span>
                <small *ngIf="formulario.get('nome')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
              </div>

              <div class="col-3">
                <div class="field ">
                  <span class="p-float-label p-input-icon-left p-input-icon-right width">
                    <i class="pi pi-id-card azul"></i>
                    <input pInputText id="cpf"  [value]="paciente?.cpf" maxlength="14" minlength="11" required class="width"  [disabled]="true"/>
                    <label for="cpf" class="azul">CPF</label>
                  </span>

                </div>
              </div>

              <div class="col-1">
                <div class="field ">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-folder-open azul"></i>
                    <input pInputText id="numPasta"  [value]="paciente?.numPasta" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="numPasta" *ngIf="disable == false" formControlName="numPasta" required class="width" />
                    <label for="numPasta" class="azul">N Pasta</label>
                  </span>
                  <small *ngIf="formulario.get('numPasta')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>
            </div>

            <div class="row flex justify-content-center m-5">
              <div class="col-3">
                <div class="field ">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-phone azul"></i>
                    <input pInputText id="telefone" [value]="paciente?.telefone" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="telefone" *ngIf="disable == false" formControlName="telefone" required class="width" onblur="replaceTelefone(1)"/>
                    <label for="nome" class="azul">Telefone</label>
                  </span>
                  <small *ngIf="formulario.get('telefone')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>
              <div class="col-3">
                <div class="field ">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-envelope azul"></i>
                    <input pInputText id="email"  [value]="paciente?.email" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="email" *ngIf="disable == false" formControlName="email" required class="width" />
                    <label for="email" class="azul">E-mail</label>
                  </span>
                  <small *ngIf="formulario.get('email')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>
              <div class="col-3">
                <div class="field">
                  <span class="p-float-label p-input-icon-left">
                    <p-calendar [value]="paciente?.dataNascimento" inputId="dataNascimento" [iconDisplay]="'input'" [showIcon]="true" [showTime]="false" class="lb3" [disabled]="true">
                      <ng-template pTemplate="inputicon" let-clickCallBack="clickCallBack" class="p-input-icon-left">
                        <i class="pi pi-calendar azul" (click)="clickCallBack($event)"></i>
                      </ng-template>
                    </p-calendar>
                    <label for="dataNascimento" class="azul">Data Nascimento</label>
                  </span>
                </div>
              </div>
            </div>

            <p-divider align="left" type="solid" >
              <i class="pi pi-map-marker" ></i>
              <b>&nbsp;&nbsp;&nbsp;Endereço</b>
            </p-divider>
            <div formGroupName="endereco">


            <div class="row flex justify-content-center m-5">
              <div class="col-2">
                <div class="field ">
                  <span class="p-float-label p-input-icon-left p-input-icon-right width">
                    <i class="pi pi-map-marker azul"></i>
                    <i [ngClass]="loading? 'pi pi-spin pi-spinner': ''" style="font-size: 1.3rem"></i>
                    <input pInputText id="cep" [value]="paciente.endereco?.cep" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="cep" *ngIf="disable == false" formControlName="cep" (blur)="buscaCEP()" minlength="8" maxlength="11" class="width"/>
                    <label for="cep" class="azul">CEP</label>
                  </span>
                  <small *ngIf="formulario.get('endereco.cep')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
                <!-- <div class="field col-3">
                  <span class="p-float-label p-input-icon-left p-input-icon-right width">
                    <i class="pi pi-map-marker azul"></i>
                    <i [ngClass]="loading? 'pi pi-spin pi-spinner': ''" style="font-size: 1.3rem"></i>
                    <input pInputText id="cep" formControlName="cep" required (blur)="buscaCEP()" minlength="8" maxlength="11" class="width" />
                    <label for="cep" class="azul">CEP</label>
                  </span>
                  <small *ngIf="formulario.get('endereco.cep')?.hasError('required')"  class="p-error "><br>* Campo obrigatório</small>
                </div> -->

              </div>
              <div class="col-3">
                <div class="field ">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-pencil azul"></i>
                    <input pInputText id="cidade" [value]="paciente.endereco?.cidade" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="cidade" *ngIf="disable == false" formControlName="cidade" required class="width"/>
                    <label for="cidade" class="azul">Cidade</label>
                  </span>
                  <small *ngIf="formulario.get('endereco.cidade')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>
              <div class="col-3">
                <div class="field ">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-pencil azul"></i>
                    <input pInputText id="bairro" [value]="paciente.endereco?.bairro" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="bairro" *ngIf="disable == false" formControlName="bairro" required class="width"/>
                    <label for="bairro" class="azul">Bairro</label>
                  </span>
                  <small *ngIf="formulario.get('endereco.bairro')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>
            </div>

            <div class="row flex justify-content-center m-5">
              <div class="col-4">
                <div class="field ">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-map azul"></i>
                    <input pInputText id="logradouro" [value]="paciente.endereco?.logradouro" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="logradouro" *ngIf="disable == false" formControlName="logradouro" required class="width"/>
                    <label for="logradouro" class="azul">Logradouro</label>
                  </span>
                  <small *ngIf="formulario.get('endereco.logradouro')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>
              <div class="col-2">
                <div class="field ">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-map azul"></i>
                    <input pInputText id="numero" [value]="paciente.endereco?.numero" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="numero" *ngIf="disable == false" formControlName="numero" required class="width"/>
                    <label for="numero" class="azul">Numero</label>
                  </span>
                  <small *ngIf="formulario.get('endereco.numero')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>
              <div class="col-3">
                <div class="field ">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-map azul"></i>
                    <input pInputText id="complemento" [value]="paciente.endereco?.complemento" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="complemento" *ngIf="disable == false" formControlName="complemento" required class="width"/>
                    <label for="complemento" class="azul">Complemento</label>
                  </span>
                  <small *ngIf="formulario.get('endereco.complemento')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>
            </div>

            <div class="row flex justify-content-center m-5">
              <div class="col-4">
                <div class="field ">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-map azul"></i>
                    <!-- <input pInputText id="nome" [value]="paciente.endereco.referencia" class="width" [disabled]="disable" /> -->
                    <input pInputText id="nome" class="width" [disabled]="disable" />
                    <label for="nome" class="azul">Referencia</label>
                  </span>
                </div>
              </div>
            </div>
            </div>
            <p-divider align="left" type="solid" >
              <i class="pi pi-users" ></i>
              <b>&nbsp;&nbsp;&nbsp;Responsável</b>
            </p-divider>

              <div class="row flex justify-content-center m-5" formGroupName="responsavel">
                <div class="col-4">
                  <div class="field">
                    <span class="p-float-label p-input-icon-left width">
                      <i class="pi pi-map azul"></i>
                      <input pInputText id="nome" [value]="paciente.responsavel?.nome" *ngIf="disable"  class="width" [disabled]="disable" />
                      <input pInputText id="nome" *ngIf="disable == false" formControlName="nome"  class="width"/>
                      <label for="nome" class="azul">Nome</label>
                    </span>
                  </div>
                </div>

                <div class="col-2">
                  <div class="field">
                    <span class="p-float-label p-input-icon-left p-input-icon-right width">
                      <i class="pi pi-map azul"></i>
                      @if (!RespValidacaoCPF && RespValidacaoCPF != null) {
                        <i class='pi pi-times' style="font-size: 1.3rem; color: #FF3D32"></i>
                      }
                      @else if (RespValidacaoCPF && RespValidacaoCPF != null) {
                        <i class='pi pi-check' style="font-size: 1.3rem; color: #136C34"></i>
                      }
                      <input pInputText id="cpf" [value]="paciente.responsavel?.cpf" *ngIf="disable"  class="width" [disabled]="disable" />
                      <input pInputText id="cpf" *ngIf="disable == false" formControlName="cpf"  maxlength="14" minlength="11" (input)="RespValidaCPF()" class="width"/>
                      <label for="cpf" class="azul">CPF</label>
                    </span>
                    <small *ngIf="!RespValidacaoCPF && RespValidacaoCPF != null"  class="p-error "><br>CPF inválido</small>
                    <small *ngIf="RespValidacaoCPF && RespValidacaoCPF != null"  style="color: #136C34"><br>CPF válido</small>
                  </div>
                </div>

                <div class="col-3">
                  <div class="field">
                    <span class="p-float-label p-input-icon-left width">
                      <i class="pi pi-map azul"></i>
                      <input pInputText id="telefone" [value]="paciente.responsavel?.telefone" *ngIf="disable" class="width" [disabled]="disable" onblur="replaceTelefone(1)" />
                      <input pInputText id="telefone" *ngIf="disable == false" formControlName="telefone"  class="width" (input)="replaceTelefone(2)"/>
                      <label for="telefone" class="azul">Telefone</label>
                    </span>
                  </div>
                </div>
              </div>


            <p-divider align="left" type="solid" >
              <i class="pi pi-file-edit" ></i>
              <b>&nbsp;&nbsp;&nbsp;Anamnese</b>
            </p-divider>
            <div formGroupName="anamnese">
            <div class="row flex justify-content-center m-5">
              <div class="col-4">
                <div class="field">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-map azul"></i>
                    <input pInputText id="problemaSaude" [value]="paciente.anamnese?.problemaSaude" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="problemaSaude" *ngIf="disable == false" formControlName="problemaSaude" required class="width"/>
                    <label for="problemaSaude" class="azul">Portador(a) de alguma doença?</label>
                  </span>
                  <small *ngIf="formulario.get('anamnese.problemaSaude')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>

              <div class="col-3">
                <div class="field">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-map azul"></i>
                    <input pInputText id="tratamento" [value]="paciente.anamnese?.tratamento" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="tratamento" *ngIf="disable == false" formControlName="tratamento" required class="width"/>
                    <label for="tratamento" class="azul">Em tratamento médico?</label>
                  </span>
                  <small *ngIf="formulario.get('anamnese.tratamento')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>


            </div>

            <div class="row flex justify-content-center m-5">
              <div class="col-3">
                <div class="field">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-map azul"></i>
                    <input pInputText id="alergia" [value]="paciente.anamnese?.alergia" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="alergia" *ngIf="disable == false" formControlName="alergia" required class="width"/>
                    <label for="alergia" class="azul">Alérgico(a) a algum medicamento?</label>
                  </span>
                  <small *ngIf="formulario.get('anamnese.alergia')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>
              <div class="col-4">
                <div class="field">
                  <span class="p-float-label p-input-icon-left width">
                    <i class="pi pi-map azul"></i>
                    <input pInputText id="remedio" [value]="paciente.anamnese?.remedio" *ngIf="disable" required class="width" [disabled]="disable" />
                    <input pInputText id="remedio" *ngIf="disable == false" formControlName="remedio" required class="width"/>
                    <label for="remedio" class="azul">Em uso de medicação?</label>
                  </span>
                  <small *ngIf="formulario.get('anamnese.remedio')?.hasError('required') && disable == false"  class="p-error "><br>* Campo obrigatório</small>
                </div>
              </div>
            </div>

            <div class="row flex justify-content-center mt-5">
              <div class="col-1"></div>
              <div class="col-4">
                <span class=" flex justify-content-start align-items-center  m-3">
                  <p-inputSwitch id="hipertenso" [value]="paciente.anamnese?.hipertenso" *ngIf="disable"></p-inputSwitch>
                  <p-inputSwitch id="hipertenso" formControlName="hipertenso" *ngIf="disable == false"></p-inputSwitch>
                  <label for="hipertenso" class="azul">&nbsp;&nbsp;Hipertenso?</label>
                </span>
                <span class=" flex justify-content-start align-items-center  m-3">
                  <p-inputSwitch id="gravida" [value]="paciente.anamnese?.gravida" *ngIf="disable" ></p-inputSwitch>
                  <p-inputSwitch id="gravida" formControlName="gravida" *ngIf="disable == false"></p-inputSwitch>
                  <label for="gravida" class="azul">&nbsp;&nbsp;Está Gestante?</label>
                </span>
              </div>
              <div class="col-4">
                <span class=" flex justify-content-start align-items-center m-3">
                  <p-inputSwitch id="traumatismoFace" [value]="paciente.anamnese?.traumatismoFace" *ngIf="disable"></p-inputSwitch>
                  <p-inputSwitch id="traumatismoFace" formControlName="traumatismoFace" *ngIf="disable == false"></p-inputSwitch>
                  <label for="traumatismoFace" class="azul">&nbsp;&nbsp;Possui algum traumatismo na face?</label>
                </span>
                <span class=" flex justify-content-start align-items-center  m-3">
                  <p-inputSwitch id="sangramentoExcessivo" [value]="paciente.anamnese?.sangramentoExcessivo" *ngIf="disable"></p-inputSwitch>
                  <p-inputSwitch id="sangramentoExcessivo" formControlName="sangramentoExcessivo" *ngIf="disable == false"></p-inputSwitch>
                  <label for="sangramentoExcessivo" class="azul">&nbsp;&nbsp;Possui sangramento excessivo?</label>
                </span>
              </div>

            </div>
            </div>
            <div class="row flex justify-content-center mt-5">
              <button pButton type="submit"  label="Salvar" icon="pi pi-save" class="btnSalvar" [disabled]="disable"  ></button>
            </div>

            </form>
        </p-tabPanel>
        <p-tabPanel header="Consultas">
          <ng-template pTemplate="header">
            <i class="pi pi-fw pi-briefcase"></i>
            <span>&nbsp;Consultas</span>
          </ng-template>
          <div class="">
            <div class="flex justify-content-between m-5">
              <span class="p-float-label p-input-icon-left search">
                <i class="pi pi-search azul" ></i>
                <input pInputText id="search"  class="search"/>
                <label for="search" class="azul">Buscar Consulta...</label>
              </span>
              <button pButton type="button" label="Nova Consulta" styleClass="linear-gradient" icon="pi pi-briefcase" (click)="novaConsultaPaciente()" ></button>
              <!-- <button pButton type="button" label="Area ADM"  styleClass="linear-gradient" (click)="cadastro()"  routerLinkActive="btnHomeAtivo"  icon="pi pi-home"></button> -->
            </div>
              <p-table
              #productsTable
              [value]="paciente.consultas"
              [rows]="10"
              [paginator]="true"
              [responsive]="true"
              [globalFilterFields]="['Paciente', 'nomeDentista', 'espec', 'pagamento']"
              [tableStyle]="{ 'min-width': '75rem' }"
              [rowHover]="true"
              [showCurrentPageReport]="true"
              dataKey="id"
              currentPageReportTemplate="Mostrando {first} de {last} de {totalRecords} produtos"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th pSortableColumn="paciente">
                    <div class="flex justify-content-between align-items-center">
                      <div class="flex justify-content-center align-items-center">
                        Paciente
                      </div>
                      <div class="flex justify-content-center align-items-center">
                        <p-sortIcon
                          field="paciente"
                          pTooltip="Ordenar"
                          tooltipPosition="top"
                        ></p-sortIcon>
                        <p-columnFilter
                          type="text"
                          field="paciente"
                          display="menu"
                          matchMode="contains"
                          [showMatchModes]="false"
                          [showOperator]="false"
                          [showAddButton]="false"
                          pTooltip="Filtrar"
                          tooltipPosition="top"
                        ></p-columnFilter>
                      </div>
                    </div>
                  </th>
                  <th pSortableColumn="nomeDentista">
                    <div class="flex justify-content-between align-items-center">
                      <div class="flex justify-content-between align-items-center">
                        Dentista
                      </div>
                      <div class="flex justify-content-between align-items-center">
                        <p-sortIcon
                          field="nomeDentista"
                          pTooltip="Ordenar"
                          tooltipPosition="top"
                          ></p-sortIcon>
                        <p-columnFilter
                          type="text"
                          field="nomeDentista"
                          display="menu"
                          matchMode="contains"
                          [showMatchModes]="false"
                          [showOperator]="false"
                          [showAddButton]="false"
                          pTooltip="Filtrar"
                          tooltipPosition="top"
                        ></p-columnFilter>
                      </div>
                    </div>
                  </th>

                  <th pSortableColumn="dataConsulta" [width]="150">
                    <div class="flex justify-content-between align-items-center">
                      <div class="flex justify-content-between align-items-center">
                        Data
                      </div>
                      <div class="flex justify-content-between align-items-center">
                        <p-sortIcon
                          field="dataConsulta"
                          pTooltip="Ordenar"
                          tooltipPosition="top"
                        ></p-sortIcon>
                        <p-columnFilter
                          type="text"
                          field="dataConsulta"
                          display="menu"
                          matchMode="contains"
                          [showMatchModes]="false"
                          [showOperator]="false"
                          [showAddButton]="false"
                          pTooltip="Filtrar"
                          tooltipPosition="top"
                        ></p-columnFilter>
                      </div>
                    </div>
                  </th>
                  <th pSortableColumn="horaConsulta" [width]="150">
                    <div class="flex justify-content-between align-items-center">
                      <div class="flex justify-content-between align-items-center">
                        Hora
                      </div>
                      <div class="flex justify-content-between align-items-center">
                        <p-sortIcon
                          field="horaConsulta"
                          pTooltip="Ordenar"
                          tooltipPosition="top"
                        ></p-sortIcon>
                        <p-columnFilter
                          type="text"
                          field="horaConsulta"
                          display="menu"
                          matchMode="contains"
                          [showMatchModes]="false"
                          [showOperator]="false"
                          [showAddButton]="false"
                          pTooltip="Filtrar"
                          tooltipPosition="top"
                        ></p-columnFilter>
                      </div>
                    </div>
                  </th>
                  <th pSortableColumn="pagamento" [width]="180">
                    <div class="flex justify-content-between align-items-center">
                      <div class="flex justify-content-between align-items-center">
                        Status
                      </div>
                      <div class="flex justify-content-between align-items-center">
                        <p-sortIcon
                          field="pagamento"
                          pTooltip="Ordenar"
                          tooltipPosition="top"
                        ></p-sortIcon>
                        <p-columnFilter
                          type="text"
                          field="pagamento"
                          display="menu"
                          matchMode="contains"
                          [showMatchModes]="false"
                          [showOperator]="false"
                          [showAddButton]="false"
                          pTooltip="Filtrar"
                          tooltipPosition="top"
                        ></p-columnFilter>
                      </div>
                    </div>
                  </th>


                  <th [width]="200"></th>
              </ng-template>

              <ng-template pTemplate="body" let-consulta>
                <tr >
                  <td>
                    {{ paciente.nome }}
                  </td>
                  <td>
                    {{ consulta?.dentista.nome }}
                  </td>
                  <td>
                    {{ consulta?.dataConsulta | date: 'dd/MM/yyyy' }}
                  </td>
                  <td>
                    {{ consulta?.dataConsulta | date: 'HH:mm' }}
                  </td>
                  <td>
                    <!-- @if (consulta?.pagamento.pago)
                        {
                          <p-tag icon="pi pi-dollar" severity="success" value="Atentida&nbsp;" [rounded]="true"></p-tag>
                        }
                      @else
                        {
                          <p-tag icon="pi pi-dollar" severity="warning" value="Agendada&nbsp;" [rounded]="true"></p-tag>
                        } -->
                        @if(!consulta.dataHoraInicioAtendimento && !consulta.dataHoraFimAtendimento &&  !consulta.ausente){
                          <p-tag severity="warning" value="&nbsp;Agendada&nbsp;" [rounded]="true"><i class="material-icons" >schedule</i></p-tag>
                        }
                      @else if (consulta.dataHoraInicioAtendimento && !consulta.dataHoraFimAtendimento) {
                        <p-tag severity="primary" value="&nbsp;Em Atendimento&nbsp;" [rounded]="true"><i class="material-icons" >timelapse</i></p-tag>
                        }
                      @else if (consulta.dataHoraInicioAtendimento && consulta.dataHoraFimAtendimento)
                        {
                          <p-tag severity="success" value="&nbsp;Atendido&nbsp;" [rounded]="true"><i class="material-icons" >task_alt</i></p-tag>
                        }
                      @else if (!consulta.dataHoraInicioAtendimento && !consulta.dataHoraFimAtendimento && consulta.ausente)
                        {
                          <p-tag severity="danger" value="&nbsp;Ausente&nbsp;" [rounded]="true"><i class="material-icons" >person_off</i></p-tag>
                        }
                  </td>

                  <td [width]="230">
                    <div class="flex justify-content-around">
                      <p-button
                        *ngIf="!iniciarConsulta"
                        icon="pi pi-pw pi-play"
                        [rounded]="true"
                        [outlined]="true"
                        [severity]="'warning'"
                        [disabled]="consulta?.dataHoraInicioAtendimento || consulta?.ausente"
                        pTooltip="Iniciar Consulta"
                        tooltipPosition="top"
                        (click)="iniciarConsulta(consulta)"
                        >
                      </p-button>
                      <p-button
                      *ngIf="iniciarConsulta"
                      icon="pi pi-spin pi-spinner"
                      [rounded]="true"
                      [outlined]="true"
                      [severity]="'warning'"
                      [disabled]="consulta?.dataHoraInicioAtendimento || consulta?.ausente"
                      pTooltip="Iniciar Consulta"
                      tooltipPosition="top"

                      >
                    </p-button>
                      <p-button
                        icon="pi pi-pw pi-info-circle"
                        [rounded]="true"
                        [outlined]="true"
                        severity="info"
                        pTooltip="Informações"
                        tooltipPosition="top"
                        (click)="consultaSelecionadaInfo(consulta?.id, 1)"
                        >
                        <!-- <i class="material-icons">info</i> -->
                      </p-button>
                      <p-button icon="pi pi-pw pi-dollar"
                        [rounded]="true"
                        [outlined]="true"
                        [severity]="consulta.pagamento.pago?'secondary':'success'"

                        [pTooltip]="consulta.pagamento.pago?'Pagamento Realizado':'Pagamento Aberto'"
                        tooltipPosition="top"
                        (onClick)="consultaSelecionadaInfo(consulta?.id, 2)"
                        >
                        <!-- <i class="material-icons">paid</i> -->
                      </p-button>
                      <!-- <p-button icon="pi"
                        [rounded]="true"
                        [outlined]="true"
                        [severity]="consulta?.pagamento.pago? 'secondary':'help'"
                        [disabled]="consulta?.dataHoraAtendimento == null && consulta?.pagamento.pago"
                        pTooltip="Reagendar"
                        tooltipPosition="top"
                        ><i class="material-icons">edit_document</i>
                      </p-button> -->
                      <!-- <p-button icon="pi"
                        [rounded]="true"
                        [outlined]="true"
                        [severity]="consulta?.pagamento.pago? 'secondary':'danger'"
                        [disabled]="consulta?.pagamento.pago"
                        pTooltip="Deletar"
                        tooltipPosition="top"
                        ><i class="material-icons">delete</i>
                      </p-button> -->
                    </div>
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr >
                    <td colspan="4">Não foram encontrado dados</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </p-tabPanel>
        <p-tabPanel header="Pagamentos">
          <ng-template pTemplate="header">
            <i class="pi pi-fw pi-dollar"></i>
            <span>&nbsp;Pagamentos</span>
          </ng-template>
          <div class="">
            <div class="flex justify-content-between m-5">
              <span class="p-float-label p-input-icon-left search">
                <i class="pi pi-search azul" ></i>
                <input pInputText id="search"  class="search"/>
                <label for="search" class="azul">Buscar Pagamento...</label>
              </span>
              <button pButton type="button" label="Novo Pagamento" styleClass="linear-gradient"   icon="pi pi-briefcase"></button>
              <!-- <button pButton type="button" label="Area ADM"  styleClass="linear-gradient" (click)="cadastro()"  routerLinkActive="btnHomeAtivo"  icon="pi pi-home"></button> -->
            </div>
              <p-table
              #productsTable
              [value]="paciente.consultas"
              [rows]="10"
              [paginator]="true"
              [responsive]="true"
              [globalFilterFields]="['Paciente', 'nomeDentista', 'espec', 'pagamento']"
              [tableStyle]="{ 'min-width': '75rem' }"
              [rowHover]="true"
              [showCurrentPageReport]="true"
              dataKey="id"
              currentPageReportTemplate="Mostrando {first} de {last} de {totalRecords} produtos"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th pSortableColumn="paciente">
                    <div class="flex justify-content-between align-items-center">
                      <div class="flex justify-content-center align-items-center">
                        Paciente
                      </div>
                      <div class="flex justify-content-center align-items-center">
                        <p-sortIcon
                          field="paciente"
                          pTooltip="Ordenar"
                          tooltipPosition="top"
                        ></p-sortIcon>
                        <p-columnFilter
                          type="text"
                          field="paciente"
                          display="menu"
                          matchMode="contains"
                          [showMatchModes]="false"
                          [showOperator]="false"
                          [showAddButton]="false"
                          pTooltip="Filtrar"
                          tooltipPosition="top"
                        ></p-columnFilter>
                      </div>
                    </div>
                  </th>
                  <th pSortableColumn="nomeDentista">
                    <div class="flex justify-content-between align-items-center">
                      <div class="flex justify-content-between align-items-center">
                        Dentista
                      </div>
                      <div class="flex justify-content-between align-items-center">
                        <p-sortIcon
                          field="nomeDentista"
                          pTooltip="Ordenar"
                          tooltipPosition="top"
                          ></p-sortIcon>
                        <p-columnFilter
                          type="text"
                          field="nomeDentista"
                          display="menu"
                          matchMode="contains"
                          [showMatchModes]="false"
                          [showOperator]="false"
                          [showAddButton]="false"
                          pTooltip="Filtrar"
                          tooltipPosition="top"
                        ></p-columnFilter>
                      </div>
                    </div>
                  </th>

                  <th pSortableColumn="dataConsulta" [width]="150">
                    <div class="flex justify-content-between align-items-center">
                      <div class="flex justify-content-between align-items-center">
                        Data
                      </div>
                      <div class="flex justify-content-between align-items-center">
                        <p-sortIcon
                          field="dataConsulta"
                          pTooltip="Ordenar"
                          tooltipPosition="top"
                        ></p-sortIcon>
                        <p-columnFilter
                          type="date"
                          field="dataConsulta"
                          display="menu"
                          matchMode="contains"
                          [showMatchModes]="false"
                          [showOperator]="false"
                          [showAddButton]="false"
                          pTooltip="Filtrar"
                          tooltipPosition="top"
                        ></p-columnFilter>
                      </div>
                    </div>
                  </th>
                  <th pSortableColumn="dataConsulta" [width]="150">
                    <div class="flex justify-content-between align-items-center">
                      <div class="flex justify-content-between align-items-center">
                        Hora
                      </div>
                      <div class="flex justify-content-between align-items-center">
                        <p-sortIcon
                          field="dataConsulta"
                          pTooltip="Ordenar"
                          tooltipPosition="top"
                        ></p-sortIcon>
                        <p-columnFilter
                          type="text"
                          field="dataConsulta"
                          display="menu"
                          matchMode="contains"
                          [showMatchModes]="false"
                          [showOperator]="false"
                          [showAddButton]="false"
                          pTooltip="Filtrar"
                          tooltipPosition="top"
                        ></p-columnFilter>
                      </div>
                    </div>
                  </th>
                  <th pSortableColumn="pagamento" [width]="180">
                    <div class="flex justify-content-between align-items-center">
                      <div class="flex justify-content-between align-items-center">
                        Status
                      </div>
                      <div class="flex justify-content-between align-items-center">
                        <p-sortIcon
                          field="pagamento"
                          pTooltip="Ordenar"
                          tooltipPosition="top"
                        ></p-sortIcon>
                        <p-columnFilter
                          type="text"
                          field="pagamento"
                          display="menu"
                          matchMode="contains"
                          [showMatchModes]="false"
                          [showOperator]="false"
                          [showAddButton]="false"
                          pTooltip="Filtrar"
                          tooltipPosition="top"
                        ></p-columnFilter>
                      </div>
                    </div>
                  </th>


                  <th [width]="200"></th>
              </ng-template>

              <ng-template pTemplate="body" let-consulta>
                <tr >
                  <td>{{ paciente.nome }}</td>
                  <td>{{ consulta?.dentista.nome }}</td>
                  <td>{{ consulta?.dataConsulta | date: 'dd/MM/yyyy HH:mm'}}</td>
                  <td>{{ consulta?.dataConsulta | date: 'HH:mm' }}</td>
                  <td>
                    @if (consulta?.pagamento.pago)
                    {
                      <p-tag icon="pi pi-dollar" severity="success" value="Atentida&nbsp;" [rounded]="true"></p-tag>
                    }
                    @else
                    {
                      <p-tag icon="pi pi-dollar" severity="warning" value="Agendada&nbsp;" [rounded]="true"></p-tag>
                    }
                  </td>

                  <td [width]="230">
                    <div class="flex justify-content-around">
                      <p-button
                        *ngIf="!iniciarConsulta"
                        icon="pi pi-pw pi-play"
                        [rounded]="true"
                        [outlined]="true"
                        [severity]="'warning'"
                        [disabled]="consulta?.dataHoraInicioAtendimento || consulta?.ausente"
                        pTooltip="Iniciar Consulta"
                        tooltipPosition="top"
                        (click)="iniciarConsulta(consulta)"
                        >
                      </p-button>
                      <p-button
                      *ngIf="iniciarConsulta"
                      icon="pi pi-spin pi-spinner"
                      [rounded]="true"
                      [outlined]="true"
                      [severity]="'warning'"
                      [disabled]="consulta?.dataHoraInicioAtendimento || consulta?.ausente"
                      pTooltip="Iniciar Consulta"
                      tooltipPosition="top"

                      >
                    </p-button>
                      <p-button
                        icon="pi pi-pw pi-info-circle"
                        [rounded]="true"
                        [outlined]="true"
                        severity="info"
                        pTooltip="Informações"
                        tooltipPosition="top"
                        (click)="consultaSelecionadaInfo(consulta?.id, 1)"
                        >
                        <!-- <i class="material-icons">info</i> -->
                      </p-button>
                      <p-button icon="pi pi-pw pi-dollar"
                        [rounded]="true"
                        [outlined]="true"
                        [severity]="consulta.pagamento.pago?'secondary':'success'"

                        [pTooltip]="consulta.pagamento.pago?'Pagamento Realizado':'Pagamento Aberto'"
                        tooltipPosition="top"
                        (onClick)="consultaSelecionadaInfo(consulta?.id, 2)"
                        >
                        <!-- <i class="material-icons">paid</i> -->
                      </p-button>
                      <!-- <p-button icon="pi"
                        [rounded]="true"
                        [outlined]="true"
                        [severity]="consulta?.pagamento.pago? 'secondary':'help'"
                        [disabled]="consulta?.dataHoraAtendimento == null && consulta?.pagamento.pago"
                        pTooltip="Reagendar"
                        tooltipPosition="top"
                        ><i class="material-icons">edit_document</i>
                      </p-button> -->
                      <!-- <p-button icon="pi"
                        [rounded]="true"
                        [outlined]="true"
                        [severity]="consulta?.pagamento.pago? 'secondary':'danger'"
                        [disabled]="consulta?.pagamento.pago"
                        pTooltip="Deletar"
                        tooltipPosition="top"
                        ><i class="material-icons">delete</i>
                      </p-button> -->
                    </div>
                  </td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr >
                    <td colspan="4">Não foram encontrado dados</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </p-tabPanel>
        <p-tabPanel header="Outros">
          <ng-template pTemplate="header">
            <i class="pi pi-fw pi-wrench"></i>
            <span>&nbsp;Outros</span>
          </ng-template>
          <div class="">
            <p>
              Em construcao ainda...
            </p>
          </div>

        </p-tabPanel>
      </p-tabView>
    </div>
  </div>
</div>

<p-dialog header='Nova Consulta' [(visible)]="novaConsulta" [modal]="true" [style]="{ width: '40vw', height: 'auto' }" class="box" [draggable]="false" [resizable]="false" [closable]="false">
  <ng-template pTemplate="content">
    <app-consulta-nova *ngIf="novaConsulta" [pacienteSelecionado]="paciente" (closeModal)="closeModalInfo($event)" (onlyClose)="onlyClose($event)"></app-consulta-nova>
  </ng-template>
</p-dialog>

<p-dialog header='Detalhes da Consulta' [(visible)]="infoConsulta" [modal]="true" [style]="{ width: '70vw',  height: '84vh' }" [draggable]="false" [resizable]="false" [closable]="false">
  <ng-template pTemplate="content">
    <app-consulta-info *ngIf="consultaSelecionada" [consultaSelecionada]="consultaSelecionada" (reloading)="reloadingTela($event)" (closeModal)="closeInfo($event)"></app-consulta-info>
  </ng-template>
</p-dialog>

<p-dialog header="Pagamento" [(visible)]="pagamentoInfo" [modal]="true" [style]="{ width: '70vw',  height: 'auto' }" [draggable]="false" [resizable]="false">
  <ng-template pTemplate="content">
    <app-pagamento-info *ngIf="consultaSelecionadaPg" [consultaSelecionadaPg]="consultaSelecionadaPg"></app-pagamento-info>
  </ng-template>
</p-dialog>

<p-dialog [(visible)]="alterarFoto" [modal]="true" [style]="{width: '50vw', heigth: 'auto'}"[draggable]="false" [resizable]="false" [closable]="false" >
  <div class="new p-3">
     <div class="flex justify-content-center">
      <div class="col-5">
        <h4>Escolha a nova foto</h4>
        <input type="file" #fileInput (change)="onFileSelected($event)">

      </div>
      <div class="col-2 flex justify-content-center">
        <p-divider layout="vertical" styleClass="hidden md:flex"></p-divider>
      </div>

      <div class="col-5" >
        <h4 class="flex justify-content-center">Previsualização da imagem</h4>
        <p-skeleton width="13rem" height="6rem" *ngIf="!imagemSelecionada" class="flex justify-content-center "></p-skeleton>
        <p-image *ngIf="imagemSelecionada"
          [src]="imagemSelecionada"
          width="180"
          alt="Nova foto de perfil"
          class="flex justify-content-center"
        ></p-image>
      </div>
    </div>
    <div class="row flex justify-content-center mt-3">
      <p-button label="Cancelar" [rounded]="true" severity="danger" [outlined]="true" icon="pi pi-times" class="mx-2" (click)="fecharModalFoto()"></p-button>
      <button pButton type="submit" icon="pi pi-save" label="Salvar"  class="btnSalvarFoto mx-2"></button>
    </div>
  </div>

</p-dialog>


